<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.pers.aiyin.fitness.mapper.CustomCourseRecordMapper">

    <resultMap id="BaseResultMap" type="com.pers.aiyin.fitness.response.CourseRecordList">
        <result column="year_mouth" jdbcType="VARCHAR" property="yearMonth" />
        <collection property="listCourse" javaType="java.util.List" ofType="com.pers.aiyin.fitness.response.CustomCourseRecord">
            <result column="course_id" jdbcType="INTEGER" property="courseId" />
            <result column="stu_id" jdbcType="INTEGER" property="stuId" />
            <result column="course_record_id" jdbcType="INTEGER" property="courseRecordId" />
            <result column="course_name" jdbcType="VARCHAR" property="courseName" />
            <result column="course_time_start" jdbcType="TIMESTAMP" property="courseTimeStart" />
            <result column="course_time_end" jdbcType="TIMESTAMP" property="courseTimeEnd" />
            <result column="room_id" jdbcType="INTEGER" property="roomId" />
            <result column="room_name" jdbcType="VARCHAR" property="roomName" />
            <result column="mouth_date" jdbcType="VARCHAR" property="monthDate" />
            <result column="coach_id" jdbcType="INTEGER" property="coachId" />
            <result column="coach_name" jdbcType="VARCHAR" property="coachName" />
            <result column="time_start_str" jdbcType="VARCHAR" property="timeStartStr" />
            <result column="time_end_str" jdbcType="VARCHAR" property="timeEndStr" />
        </collection>
    </resultMap>

    <resultMap id="BaseResultMap1" type="com.pers.aiyin.fitness.response.CustomCourseR">
            <result column="course_id" jdbcType="INTEGER" property="courseId" />
            <result column="stu_id" jdbcType="INTEGER" property="stuId" />
            <result column="course_record_id" jdbcType="INTEGER" property="courseRecordId" />
            <result column="course_name" jdbcType="VARCHAR" property="courseName" />
            <result column="stu_name" jdbcType="VARCHAR" property="stuName" />
    </resultMap>

    <select id="getRecordByStuId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select course.course_id,course_name,course_time_start,course_time_end,room_id,room_name,stu_id,coach_id,
            coach_name,DATE_FORMAT(course_time_start,'%Y-%m') as year_mouth,
            DATE_FORMAT(course_time_start,'%m-%d') as month_date,
               DATE_FORMAT(course_time_start,'%H:%i') as time_start_str,
              DATE_FORMAT(course_time_end,'%H:%i') as time_end_str
            FROM course left join courserecord ON  course.course_id=courserecord.course_id
            where  courserecord.stu_id= #{stuId} group by year_mouth,course.course_id
    </select>
    <select id="getRecordByCoachId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select stu_id,course.course_id,course_name,
        course_time_start,course_time_end,room_id,room_name,coach_id,coach_name,
        DATE_FORMAT(course_time_start,'%Y-%m') as year_mouth,
          DATE_FORMAT(course_time_start,'%m-%d') as mouth_date,
           DATE_FORMAT(course_time_start,'%H:%i') as time_start_str,
              DATE_FORMAT(course_time_end,'%H:%i') as time_end_str
        from courserecord left join course ON  course.course_id=courserecord.course_id
        where courserecord.stu_id= #{coachId}
        group by year_mouth,course.course_id
    </select>
    <select id="getSelectStudent" parameterType="java.lang.Integer" resultMap="BaseResultMap1">
        select sr.stu_id,s.stu_name,course_id,course_record_id
        from courserecord sr
        left join student s on sr.stu_id=s.stu_id
         where course_id=#{courseId}

    </select>
</mapper>